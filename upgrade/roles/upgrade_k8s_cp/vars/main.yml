# Copyright 2024 Dell Inc. or its subsidiaries. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---

# main.yml
telemetry_config_file: "{{ installed_omnia_path }}/input/telemetry_config.yml"
telemetry_vault_filename: "{{ installed_omnia_path }}/input/.telemetry_vault_key"
telemetry_config_syntax_fail_msg: "Failed.Syntax errors present in telemetry_config.yml.Fix errors and re-run playbook again."
vault_file_perm: '0644'

# modify_sw_json.yml
upgrade_config_path: "{{ role_path }}/../../upgrade_config.yml"
metadata_file_path: "/opt/omnia/offline/.data/metadata.yml"
sw_json_path: "{{ installed_omnia_path }}/input/software_config.json"
sw_config_template_path: "../templates/upgrade_software_config.j2"
input_dir_path: "{{ role_path }}/../../../input/upgrade_software_config.json"
file_permission: "0644"

# download_k8s_pkgs.yml
upgrade_telemetry_json_path_ubuntu: "../files/{{ control_plane_os }}/{{ control_plane_os_version }}/telemetry_{{ k8s_version }}.json"
upgrade_telemetry_json_path_rocky: "../files/{{ control_plane_os }}/telemetry_{{ k8s_version }}.json"
upgrade_telemetry_json_path_rhel: "../files/rhel/telemetry_{{ k8s_version }}.json"
telemetry_json_path_ubuntu_rocky: "{{ role_path }}/../../../input/config/{{ control_plane_os }}/{{ control_plane_os_version }}/telemetry.json"
telemetry_json_path_rhel: "{{ role_path }}/../../../input/config/rhel/{{ control_plane_os_version }}/telemetry.json"
control_plane_os_ubuntu: "ubuntu"
control_plane_os_rocky: "rocky"
control_plane_os_rhel: "redhat"
telemetry_backup_path: "../files/"
original_telemetry_bk: "../files/telemetry.json"
control_plane_os_as_rhel: "rhel"
run_local_repo: "ansible-playbook {{ role_path }}/../../../local_repo/local_repo.yml -e sw_config_json_path={{ input_dir_path }}"

# metallb_cleanup.yml
metallb_pools_path: "/etc/kubernetes/pools.yaml"
metallb_layer2_path: "/etc/kubernetes/layer2.yaml"
metallb_crd_path: "/etc/kubernetes/metallb.yaml"
ctr_pkg_src: "/usr/bin/ctr"
ctr_pkg_dest: "/usr/local/bin"
copy_permission: "0755"

# upgrade_k8s.yml
access_file_path: "/opt/omnia/offline/local_repo_access.yml"
telemetry_config_path: "{{ installed_omnia_path }}/input/telemetry_config.yml"
kubespray_path: "/opt/omnia/kubespray"
crictl_src: "/usr/local/bin/crictl"
crictl_dest: "/usr/bin"
fail_msg_kubespray_not_found: "Kubespray git tar file not found in local repo."
inventory_grps:
    - 'kube_control_plane'
    - 'kube_node'
    - 'etcd'
    - 'k8s_cluster'
kube_version_list_v1_29_5: # noqa: var-naming[pattern]
    - v1.27.0
    - v1.28.0
    - v1.29.5
k8s_var_src: "../templates/k8s_var.j2"
k8s_var_dest: "{{ role_path }}/files/k8s_var_{{ kube_version }}.yml"
bin_path: "/usr/bin"
local_bin_path: "/usr/local/bin"
binary_list: ['kubectl', 'kubeadm', 'kubelet']
inv_path: "{{ installed_omnia_path }}/telemetry/roles/orchestrator/files/k8s_inv.ini"
pods_state_fail_msg: "Not all pods are in running state. Ensure all pods are running and re-run upgrade_cp.yml"
nodes_output_fail_msg: "Node is not in ready state. Ensure the node is healthy and re-run upgrade_cp.yml"
track_file_path: "{{ role_path }}/files/track_upgrade.txt"
k8s_upgrade_failed_msg: "Failed to upgrade Kubernetes on control plane. Please execute upgrade/restore_cp.yml to restore Kubernetes version to v1.26.12 on control plane and re-run upgrade_cp.yml" # noqa: yaml[line-length]
binary_package_list: ['crictl']

user_msg_upgrade: |

   ***************************************************************************************************************************************************
   Kubernetes Upgrade on Control Plane is sequential in nature. Upgrade will happen from v1.26.12 -> v1.27.0 -> v1.28.0 -> v1.29.5

   The upgrade process will take approx. 15-20 minutes to complete.
   ****************************************************************************************************************************************************

upgrade_success_msg: |

   ***************************************************************************************************************************************************
   Successfully upgraded Kubernetes version to v1.29.5 on the control plane.
   ****************************************************************************************************************************************************
